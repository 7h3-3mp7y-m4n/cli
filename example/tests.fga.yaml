---
name: FolderBox # store name
model-file: ./model.fga # a global model that would apply to all tests
# model can be used instead of model_file
#model: |
#  model
#    schema 1.1
#  type user
#  ...
tuples: # global tuples that would apply to all tests
  - user: folder:5
    relation: parent
    object: folder:product-2021
  - user: folder:product-2021
    relation: parent
    object: folder:product-2021Q1
tests:
  - name: "folder-document-access"
    description: ""
    # Each tests can have an overriding model/model_file
    #model_file: ...
    #model: ...
    tuples: # tuples in tests are appended to the global tuples and do not replace them
      - user: user:anne
        relation: owner
        object: folder:product
      - user: folder:product
        relation: parent
        object: folder:product-2021
      - user: user:beth
        relation: viewer
        object: folder:product-2021
    check: # Each check test is made of: a user, an object and the expected result for one or more relations
      - user: user:anne
        object: folder:product-2021
        assertions:
          can_view: true
          can_write: true
          can_share: false
      - user: user:beth
        object: folder:product-2021
        assertions:
          can_view: true
          can_write: false
          can_share: false
      - user: user:anne
        object: folder:product-2021Q1
        assertions:
          can_view: true
          can_write: true
          can_share: false
    list-objects: # Each check test is made of: a user, an object type and the expected result for one or more relations
      - user: user:anne
        type: folder
        assertions:
          can_view:
            - folder:product
            - folder:product-2021
            - folder:product-2021Q1
          can_write:
            - folder:product
            - folder:product-2021
            - folder:product-2021Q1
          can_share:
            - folder:product
      - user: user:beth
        type: folder
        assertions:
          can_view:
            - folder:product-2021
            - folder:product-2021Q1
          can_write: []
          can_share: []

  - name: "Complex Test"
    model: | #complex model
      model
        schema 1.1
      type user
      type folder
        relations
          define parent: [folder]
          define owner: [group]
          define folder_viewer: [user, group#member] or folder_viewer from owner or folder_viewer from parent
          define blocked: [user, user:*, group#member] or nblocked from parent
          define unblocked: [user, group#member]
          define nblocked: blocked but not unblocked
          define allowed: [user, user:*, group#member] or allowed from parent
          define super_allowed: [user, group#member] or super_allowed from parent
          define viewer: folder_viewer and allowed and super_allowed
          define can_view: viewer but not nblocked
      type group
        relations
          define parent: [group]
          define allowed: [user, group#member] or allowed from parent
          define super_allowed: [user, group#super_allowed]
          define blocked: [user, group#member] or blocked from parent
          define og_member: [user] or member from parent
          define allowed_member: og_member and allowed and super_allowed
          define member: allowed_member but not blocked
          define folder_viewer: [group#member] or folder_viewer from parent
    tuples:
      - user: user:anne
        relation: og_member
        object: group:marketing
      - user: user:anne
        relation: allowed
        object: group:marketing
      - user: user:anne
        relation: super_allowed
        object: group:marketing
      - user: user:beth
        relation: og_member
        object: group:marketing
      - user: user:beth
        relation: allowed
        object: group:marketing
      - user: user:beth
        relation: super_allowed
        object: group:marketing
      - user: user:carl
        relation: og_member
        object: group:marketing
      - user: user:carl
        relation: allowed
        object: group:marketing
      - user: user:dan
        relation: og_member
        object: group:marketing
      - user: user:dan
        relation: allowed
        object: group:marketing
      - user: user:dan
        relation: super_allowed
        object: group:marketing
      - user: user:dan
        relation: blocked
        object: group:marketing
      - user: user:emily
        relation: og_member
        object: group:marketing
      - user: user:emily
        relation: allowed
        object: group:marketing
      - user: user:emily
        relation: super_allowed
        object: group:marketing
      - user: user:gabriel
        relation: og_member
        object: group:marketing
      - user: user:gabriel
        relation: allowed
        object: group:marketing
      - user: user:gabriel
        relation: super_allowed
        object: group:marketing
      - user: user:harriette
        relation: og_member
        object: group:marketing
      - user: user:harriette
        relation: allowed
        object: group:marketing
      - user: user:harriette
        relation: super_allowed
        object: group:marketing
      - user: user:gabriel
        relation: og_member
        object: group:admin
      - user: user:gabriel
        relation: allowed
        object: group:admin
      - user: user:gabriel
        relation: super_allowed
        object: group:admin
      - user: group:marketing#member
        relation: folder_viewer
        object: group:marketing
      - user: group:marketing
        relation: parent
        object: group:digitalmktg
      - user: group:marketing#super_allowed
        relation: super_allowed
        object: group:digitalmktg
      - user: group:digitalmktg
        relation: owner
        object: folder:1
      - user: folder:1
        relation: parent
        object: folder:2
      - user: folder:2
        relation: parent
        object: folder:3
      - user: folder:3
        relation: parent
        object: folder:4
      - user: folder:4
        relation: parent
        object: folder:5
      - user: group:marketing#member
        relation: allowed
        object: folder:1
      - user: group:marketing#member
        relation: super_allowed
        object: folder:1
      - user: user:beth
        relation: blocked
        object: folder:2
      - user: user:emily
        relation: blocked
        object: folder:1
      - user: user:emily
        relation: unblocked
        object: folder:2
      - user: user:gabriel
        relation: blocked
        object: folder:1
      - user: user:harriette
        relation: unblocked
        object: folder:5
      - user: user:*
        relation: blocked
        object: folder:4
      - user: user:*
        relation: allowed
        object: folder:4
      - user: group:admin#member
        relation: unblocked
        object: folder:2
      - user: user:anne
        relation: unblocked
        object: folder:product-2021
    check:
      - user: user:anne
        object: folder:3
        assertions:
          can_view: true
      - user: user:beth
        object: folder:3
        assertions:
          can_view: false
      - user: user:carl
        object: folder:3
        assertions:
          can_view: false
      - user: user:dan
        object: folder:3
        assertions:
          can_view: false
      - user: user:emily
        object: folder:3
        assertions:
          can_view: true
      - user: user:frida
        object: folder:3
        assertions:
          can_view: false
      - user: user:gabriel
        object: folder:3
        assertions:
          can_view: true
      - user: user:harriette
        object: folder:3
        assertions:
          can_view: true
      - user: user:anne
        object: folder:product-2021Q1
        assertions:
          can_view: true
      - user: user:harriette
        object: folder:product-2021Q1
        assertions:
          can_view: true
    list-objects:
      - user: user:anne
        type: folder
        assertions:
          can_view:
            - folder:1
            - folder:2
            - folder:3
            - folder:product-2021
            - folder:product-2021Q1
      - user: user:beth
        type: folder
        assertions:
          can_view:
            - folder:1
      - user: user:carl
        type: folder
        assertions:
          can_view: []
      - user: user:dan
        type: folder
        assertions:
          can_view: []
      - user: user:emily
        type: folder
        assertions:
          can_view:
            - folder:2
            - folder:3
      - user: user:frida
        type: folder
        assertions:
          can_view: []
      - user: user:gabriel
        type: folder
        assertions:
          can_view:
            - folder:2
            - folder:3
      - user: user:harriette
        type: folder
        assertions:
          can_view:
            - folder:1
            - folder:2
            - folder:3
            - folder:5
            - folder:product-2021
            - folder:product-2021Q1
